# HTTPS 설정 다음 단계

## ✅ 완료
- 로컬 CA 설치 완료

## 다음 단계

### 1단계: 인증서 파일 생성

서버에서 다음 명령어 실행:

```powershell
cd C:\www\cutflow\api
.\mkcert-v1.4.4-windows-amd64.exe 106.254.252.42 localhost 127.0.0.1
```

**예상 출력:**
```
Created a new certificate valid for the following names 📜
 - "106.254.252.42"
 - "localhost"
 - "127.0.0.1"

The certificate is at "./106.254.252.42+2.pem" and the key at "./106.254.252.42+2-key.pem" ✅
```

### 2단계: 생성된 파일 확인

```powershell
dir 106.254.252.42*
```

다음 파일이 생성되어야 합니다:
- `106.254.252.42+2.pem` (인증서)
- `106.254.252.42+2-key.pem` (개인 키)

### 3단계: 인증서 파일을 서버 프로젝트 폴더로 복사

`server.js`는 프로젝트 루트(`C:\IIWeb\CutFlow`)에서 인증서를 찾습니다.

**옵션 A: 인증서를 프로젝트 폴더로 복사 (권장)**
```powershell
Copy-Item C:\www\cutflow\api\106.254.252.42+2*.pem C:\IIWeb\CutFlow\
```

**옵션 B: server.js에서 인증서 경로 수정**
인증서 경로를 `C:\www\cutflow\api`로 변경

### 4단계: 서버 재시작

```cmd
# 서버 중지 (Ctrl+C)
# 서버 재시작
cd C:\IIWeb\CutFlow
node server.js
```

**예상 출력:**
```
🚀 HTTPS 서버가 https://0.0.0.0:3443 에서 실행 중입니다.
📁 업로드 폴더: ...
📁 출력 폴더: ...
🌐 허용된 Origin: ...
🚀 HTTP 서버가 http://0.0.0.0:3001 에서 실행 중입니다.
```

### 5단계: 방화벽 포트 3443 열기

1. Windows 방화벽 고급 설정
2. 인바운드 규칙 → 새 규칙
3. 포트 선택 → TCP → 특정 로컬 포트: `3443`
4. 연결 허용 선택
5. 모든 프로필 적용
6. 이름: "CutFlow API HTTPS Port 3443"

### 6단계: HTTPS 서버 테스트

브라우저에서 직접 접속:
```
https://106.254.252.42:3443/api/health
```

**예상 응답:**
```json
{"status":"ok","timestamp":"2024-..."}
```

⚠️ 브라우저에서 "안전하지 않은 연결" 경고가 나타날 수 있습니다. "고급" → "계속 진행" 클릭

### 7단계: Vercel 환경 변수 변경

1. Vercel 대시보드 → Settings → Environment Variables
2. `VITE_API_BASE_URL` 값 변경:
   - 기존: `http://106.254.252.42:3001`
   - 변경: `https://106.254.252.42:3443`
3. Save
4. 재배포 (Git 푸시 또는 수동 재배포)

### 8단계: 최종 테스트

1. https://cutflow.vercel.app/ 접속
2. "서버 연결 실패" 메시지가 사라졌는지 확인
3. 파일 업로드 테스트
4. Network 탭에서 Request URL이 `https://106.254.252.42:3443`인지 확인

## 빠른 체크리스트

- [ ] 인증서 파일 생성 완료
- [ ] 인증서 파일을 프로젝트 폴더로 복사 완료
- [ ] 서버 재시작 완료
- [ ] HTTPS 서버가 포트 3443에서 실행 중
- [ ] 방화벽 포트 3443 열림
- [ ] `https://106.254.252.42:3443/api/health` 접속 성공
- [ ] Vercel 환경 변수 `https://106.254.252.42:3443`로 변경
- [ ] Vercel 재배포 완료
- [ ] 파일 업로드 테스트 성공

## 문제 해결

### 인증서 파일을 찾을 수 없다는 에러
- 파일이 올바른 위치에 있는지 확인
- 파일 이름이 정확한지 확인 (`106.254.252.42+2.pem`, `106.254.252.42+2-key.pem`)

### HTTPS 서버가 시작되지 않음
- 인증서 파일 경로 확인
- 서버 로그에서 에러 메시지 확인

### 브라우저에서 "안전하지 않은 연결" 경고
- mkcert로 생성한 인증서는 로컬 CA가 설치된 브라우저에서만 신뢰됨
- "고급" → "계속 진행" 클릭하여 진행 가능

