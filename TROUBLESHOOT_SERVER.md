# 서버 연결 실패 문제 해결

## 현재 상황
브라우저에 "⚠️ 서버 연결 실패" 메시지 표시

## 단계별 확인 및 해결

### 1단계: 서버 실행 확인

원격 데스크톱에서 서버가 실행 중인지 확인:

#### Windows에서 확인:
```cmd
# PowerShell 또는 CMD에서
netstat -ano | findstr :3001
```

포트 3001이 LISTENING 상태여야 합니다.

#### 서버가 실행되지 않았다면:
```cmd
cd C:\IIWeb\CutFlow  # 또는 배포한 경로
node server.js
```

또는 PM2 사용 시:
```cmd
pm2 start server.js --name cutflow-api
pm2 list
```

### 2단계: 서버 헬스 체크

브라우저에서 직접 접속 테스트:

```
http://106.254.252.42:3001/api/health
```

**예상 응답:**
```json
{"status":"ok","timestamp":"2024-..."}
```

#### 결과에 따른 조치:

✅ **응답이 정상적으로 오는 경우:**
- 서버는 정상 작동 중
- 다음 단계로 진행 (방화벽, CORS 확인)

❌ **연결 실패 (타임아웃 또는 연결 거부):**
- 방화벽 문제 가능성
- 서버가 외부 접근을 허용하지 않음
- 3단계로 진행

❌ **404 Not Found:**
- 서버는 실행 중이지만 경로 문제
- 서버 코드 확인 필요

### 3단계: Windows 방화벽 확인

#### 방화벽 규칙 추가:

1. **Windows 방화벽 고급 설정 열기**
   - Windows 검색: "방화벽 고급 설정"
   - 또는: 제어판 → 시스템 및 보안 → Windows Defender 방화벽 → 고급 설정

2. **인바운드 규칙 추가**
   - 왼쪽 메뉴: "인바운드 규칙"
   - 오른쪽: "새 규칙"
   - 규칙 종류: "포트"
   - 프로토콜: "TCP"
   - 특정 로컬 포트: `3001`
   - 작업: "연결 허용"
   - 프로필: 모두 체크 (도메인, 개인, 공용)
   - 이름: "CutFlow API Port 3001"

3. **아웃바운드 규칙도 동일하게 추가** (선택사항)

### 4단계: 서버 코드 확인

`server.js` 파일에서 다음 확인:

1. **포트 확인:**
```javascript
const PORT = process.env.PORT || 3001;
```

2. **호스트 확인:**
```javascript
const HOST = process.env.HOST || '0.0.0.0'; // 모든 인터페이스에서 접근 가능
```

3. **CORS 설정 확인:**
```javascript
const allowedOrigins = [
  'https://cutflow.vercel.app',  // 이게 있어야 함
  // ...
];
```

### 5단계: 네트워크 확인

#### 외부에서 접근 가능한지 테스트:

다른 컴퓨터나 모바일에서:
```
http://106.254.252.42:3001/api/health
```

또는 온라인 도구 사용:
- https://www.yougetsignal.com/tools/open-ports/
- 포트: 3001
- IP: 106.254.252.42

### 6단계: 서버 로그 확인

서버 콘솔에서 다음 메시지가 보여야 합니다:
```
🚀 서버가 http://0.0.0.0:3001 에서 실행 중입니다.
📁 업로드 폴더: ...
📁 출력 폴더: ...
🌐 허용된 Origin: ...
```

요청이 들어오면 로그가 출력됩니다.

## 빠른 체크리스트

- [ ] 서버가 실행 중인가? (`netstat -ano | findstr :3001`)
- [ ] `http://106.254.252.42:3001/api/health` 접속 가능한가?
- [ ] Windows 방화벽에서 포트 3001 허용했는가?
- [ ] 서버가 `0.0.0.0:3001`로 바인딩되어 있는가?
- [ ] CORS 설정에 `https://cutflow.vercel.app`이 포함되어 있는가?

## 즉시 확인할 사항

1. **서버 실행 확인:**
   - 원격 데스크톱에서 서버 콘솔 확인
   - 에러 메시지가 있는지 확인

2. **헬스 체크:**
   - 브라우저에서 `http://106.254.252.42:3001/api/health` 접속
   - 응답 확인

3. **방화벽:**
   - Windows 방화벽 설정 확인
   - 포트 3001 규칙 추가

## 다음 단계

위 단계를 순서대로 확인하고, 어느 단계에서 문제가 발생하는지 알려주세요!

